
#gateway

# zuul
#zuul
## 应用场景
承载一些微服务的公共能力，比如认证
对外统一暴露、单点入口
路由转发
限流熔断

红绿部署、蓝绿部署

流量转发的测试集群，进行开发者测试

埋点测试---流量转发到埋点集群

金丝雀调试

调试集群

失败注入，进行测试

降级测试

跨区高可用

防爬防攻击

## 缺点
阻塞式线程
one request per thread

## netflix zuul  发展历史
- 2012年netflix开源
	- 可动态发布过滤器
	- zuul 是怪兽的意思，寓意看门神兽
- 2014年被纳入spring cloud 体系



## 架构体系
![[Pasted image 20220423060226.png]]

- 管理
- 加载
- 运行时

请求处理流程
![[Pasted image 20220423060433.png]]


过滤器
- 类型
	- 前置
		- 认证
		- 选路由
		- 日志
		- 。。。
	- 路由
	- 后置
		- 增加header
		- 统计、度量
		- 将响应流返回
- 顺序
	- 同一个类型中可指定熟悉怒
- 条件 criteria
- 动作 
	- 条件满足后执行的动作

## zull 核心代码
[netflix/zuul](https://github.com/Netflix/zuul)
[教学版本](https://github.com/spring2go/s2g-zuul)




过滤器
前置过滤器
路由过滤器
后置过滤器

zuul 对接 apollo


## 最佳实践

- 配合apollo动态配置
- 配合hystrix熔断限流
- CAT做调用链分析
- 连接池管理
#  spring cloud zuul
netflix zuul core  + spring boot

- EnableZuulProxy
- 去掉了动态过滤器加载！！

但是spring的特点就是开箱即用。

# zuul 2.0
特点非阻塞异步模式
![[Pasted image 20220423150616.png]]


对于网关来说，是非计算密集型的应用，所以异步非阻塞很适合

异步的缺点：
- 编程模型复杂
- 开发调试困难
- ThreadLocal在并发、异步、多线程情况下就比较麻烦

优点：
- 支持http/2
- 自适应重试
- 。。。。



# spring cloud gateway
#spring-cloud-gateway


# 参考

[geektime - lab](https://github.com/spring2go/zuul_lab)
