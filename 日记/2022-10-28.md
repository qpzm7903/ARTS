
#nginx-工作原理 

```mermaid
classDiagram
	class Master
	class Worker
	Master o-- Worker
```

master负责加载配置文件
woker进程负责流量处理


#nginx-config
默认配置
/usr/local/nginx/conf/nginx.conf

配置文件之间的引用: `include`
- http
	- include mine.types
		- 支持的content-type
	- default_type 默认的 content-type
	- sendfile on; # 零拷贝
		- 也就是文件是否经过程序，可以直接让内核读取，并发送出去，避免多余的一次数据拷贝
	- keepalive_timeout 65;  // 超时时间
	- server # 一个虚拟的服务器  virtual host
		- listen 80;  # 侦听端口号
		- server_name localhost; # virtual host name , 域名、主机名，ip , 可以支持多个，空格隔开。
			- 支持通配符
				- 比如*
				- 
		- location /  # 匹配uri 支持正则
			- root html;  
			- index index.html index.htm;
		- error_page 500 502 503 504 /50x.html; # 错误处理页
		- location = /50x.html
			- root html;

总结：
server_name 负责 域名
[location](https://nginx.org/en/docs/http/ngx_http_core_module.html#location) 负责 uri
语法
```nginx
Syntax:	location [ = | ~ | ~* | ^~ ] uri { ... }
location @name { ... }
Default:	—
Context:	server, location
```  


#nginx-vhost-demo


在同一个ip上，处理多个端口
server 里的root属性表示服务寻找资源的根路径，如果不是`/`开头，那么就是相对路径，相对当前nginx
```nginx.conf

worker_processes 1;

events {
    worker_connections 1024;
}


http {
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;
    server {
        listen 80;
        server_name localhost;
        location / {
            root html;
            index index.html index.htm;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root html;
        }
    }

    server {
        listen 81;
        server_name localhost;
        location / {
            root /site/code;
            index index.html index.htm;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root html;
        }
    }

    server {
        listen 82;
        server_name localhost;
        location / {
            root /site/image;
            index index.html index.htm;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root html;
        }
    }

    server {
        listen 83;
        server_name localhost;
        location / {
            root /site/note;
            index index.html index.htm;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root html;
        }
    }

    server {
        listen 84;
        server_name localhost;
        location / {
            root /site/vod;
            index index.html index.htm;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root html;
        }
    }
}

```


/site 路径下文件
```log
[root@localhost /]# tree site
site
├── code
│   └── index.html
├── image
│   └── index.html
├── note
│   └── index.html
└── vod
    └── index.html
```



#nginx-反向代理

什么是反向代理
代表用户向服务器发起请求。所以客户端的流量先到nginx，然后转发到后端服务器。nginx收到结果后，发送会客户端。
服务提供方提供的

那么正向代理呢？
客户端自己提供的。比如客户端可以配置vpn，访问外网。


差别？两者都是代理服务器，区别是在哪里


https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass

location

proxy_pass http://hostname
