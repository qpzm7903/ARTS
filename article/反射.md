[TOC]



# 反射

## 反射作用

运行期间改变程序的行为

反射的缺点？

性能不够好---原因是

可能有安全问题

内部暴露---比如私有方法也能反射执行



## Class

java虚拟机为每一种类型都创建了对应的Class实例，实例中包含引用类型、基础类型。

Class是反射的入口。Class包含了它的成员以及类型信息，并提供了创建对应类型实例的方法。



### 获取Class

没有对应的构造器，怎么获取Class？



#### `Object.getClass()`

如果有实例对象，直接`.getClass`方法就可以调用

#### `.class`

如果没有实例对象，但是有这个类型，那么类型名`.class`也可以获取对应的Class对象。

#### `Class.forName`静态方法

都没有的情况下，可以用这个方法。传入想要获取类的全限定名，也就是包含完整包名的名称。

这个方法无法获取基础数据类型。

那么数组类型呢？数组类型的语法是只有一个左括号，接着是类型的编码，然后到数据类型。

基础类型的数组不包含数据类型，引用类型的包含。

编码形式如下

| Element Type       |      | Encoding      |
| ------------------ | ---- | ------------- |
| boolean            |      | Z             |
| byte               |      | B             |
| char               |      | C             |
| class or interface |      | L*classname*; |
| double             |      | D             |
| float              |      | F             |
| int                |      | I             |
| long               |      | J             |
| short              |      | S             |

可以同`getName`方法来看看。

```java
System.out.println(String[].class.getName());  // [Ljava.lang.String;
System.out.println(byte[].class.getName()); // [B
System.out.println(int[].class.getName());// [I
System.out.println(long[].class.getName());// [J
System.out.println(double[].class.getName());// [D
System.out.println(float[].class.getName());// [F
System.out.println(boolean[].class.getName());// [Z
System.out.println(char[].class.getName());// [C
System.out.println(short[].class.getName());// [S
```

#### TYPE字段

void类型和基础类型的包装类型提供了方便的获取Class对象的字段，比如

```java
System.out.println(Void.TYPE.getName()); // void
System.out.println(Integer.TYPE.getName()); // int
```



#### 返回Class的一些方法

[`Class.getSuperclass()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getSuperclass--)

返回父类的Class

[`Class.getClasses()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getClasses--)

返回该class内的内部public类、接口，枚举，包含这个类继承下来的。

[`Class.getDeclaredClasses()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredClasses--)

返回该类内部声明的类、接口、枚举

### 访问修饰符和类型

[`Class.getModifiers()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getModifiers--)

每个修饰符都有一个值，这个方法会返回修饰符值之和。

比如public final 的值是17。

```java
public class Modifier {
    public static final int PUBLIC = 1;
    public static final int PRIVATE = 2;
    public static final int PROTECTED = 4;
    public static final int STATIC = 8;
    public static final int FINAL = 16;
    public static final int SYNCHRONIZED = 32;
    public static final int VOLATILE = 64;
    public static final int VARARGS = 128;
    public static final int TRANSIENT = 128;
    public static final int NATIVE = 256;
    public static final int INTERFACE = 512;
    public static final int ABSTRACT = 1024;
    public static final int STRICT = 2048;
    public static final int ANNOTATION = 8192;
    public static final int ENUM = 16384;
}
```



### 获取方法、属性、构造器

| [`Class`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html) API | List of members? | Inherited members? | Private members? |
| ------------------------------------------------------------ | ---------------- | ------------------ | ---------------- |
| [`getDeclaredField()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredField-java.lang.String-) | no               | no                 | yes              |
| [`getField()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getField-java.lang.String-) | no               | yes                | no               |
| [`getDeclaredFields()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--) | yes              | no                 | yes              |
| [`getFields()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getFields--) | yes              | yes                | no               |



| [`Class`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html) API | List of members? | Inherited members? | Private members? |
| ------------------------------------------------------------ | ---------------- | ------------------ | ---------------- |
| [`getDeclaredMethod()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredMethod-java.lang.String-java.lang.Class...-) | no               | no                 | yes              |
| [`getMethod()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getMethod-java.lang.String-java.lang.Class...-) | no               | yes                | no               |
| [`getDeclaredMethods()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredMethods--) | yes              | no                 | yes              |
| [`getMethods()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getMethods--) | yes              | yes                | no               |



| [`Class`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html) API | List of members? | Inherited members? | Private members? |
| ------------------------------------------------------------ | ---------------- | ------------------ | ---------------- |
| [`getDeclaredConstructor()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredConstructor-java.lang.Class...-) | no               | N/A1               | yes              |
| [`getConstructor()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getConstructor-java.lang.Class...-) | no               | N/A1               | no               |
| [`getDeclaredConstructors()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredConstructors--) | yes              | N/A1               | yes              |
| [`getConstructors()`](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getConstructors--) | yes              | N/A1               | no               |



这三类都很有的特点，带有declared的都是不带继承的，会包含private的，带s的就是list。



### 类、方法都获取到了，怎么动态调用？



## members

类的成员包括Filed、method以及constructor

每一个都应该关注怎么获取、类型，调用

### Field

名称、类型、修饰符、注解

#### Obtaining Field Types

`Filed f = class.getFiled(filedName)`

#### Retrieving and Parsing Field Modifiers

1. 访问修饰符 :`public ,protected,private`

2. 控制运行期行为的字段:`transient,volatile`

3. 限制实例数的:`static`

4. 禁止修改的:`final`
5. 注解

类上的修饰符和方法上的修饰符基本相同，从`Filed.getModifiers`获取也是获取到对应的常量值。



#### Getting and Setting Field Values

```java
Field f = Class.getDeclaredField("fieldName");
f.set*(object,value);
```

可以设置基本数据类型、数组、引用类型

要注意的是，如果类型是基础类型，传入的value也要是基础类型，不能是包装类型，都要一一对应。

同样，final类型也不能设值。但是可以通过设置可访问属性改变这个性质:`field.setAccessible(true)`，这个能作用的前提是在当前安全管理器里是允许的。

### method

[`java.lang.reflect.Method`](https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html) 

#### Obtaining Method Type Information 

获取出参、入参、异常声明

```java
m.getReturnType()
m.getGenericReturnType())

Class<?>[] pType = m.getParameterTypes();
Type[] gpType = m.getGenericParameterTypes();

Class<?>[] xType = m.getExceptionTypes();
Type[] gxType = m.getGenericExceptionTypes();
```

#### Obtaining Names of Method Parameters 

要获取参数的名称，编译的时候`javac`参数要加上 -parameters，不然会按照合成的参数名出现，arg0,1,2这样的。

```java
Parameter[] params = Method.getParameters()
```

Parameter有很多方法判断，以及获取相应的信息。



#### Retrieving and Parsing Method Modifiers 



Invoking Methods





### constructor

